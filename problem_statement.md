# Контекст
Есть сервера, на которых запущен экспортер системных метрик
[node_exporter](https://github.com/prometheus/node_exporter), пример выдаваемых метрик приложен в файле
[scrape_example.txt](./scrape_example.txt). Так же в свободном доступе есть пример
[docker-compose.yml](https://github.com/docker/awesome-compose/tree/master/prometheus-grafana), который
поднимает графану и прометеус в докере.

Предполагается проектная работа, с почасовой оплатой. Результаты планирую выложить в open-source, нужно
будет контрибутить в мой репозиторий на гитхабе.

# Задача 1
Надо написать скрипт (желательно POSIX совместимый shell, в крайнем случай js или python) со логикой,
описанной ниже. Запускаться все будет на ubuntu 22.04.
### Входные данные
 - адреса экспортеров метрик (https + basic auth), их будет несколько. По формату я думал передавать
 массив в переменной окружения, но если у вас есть лучшее предложение - давайте обсудим
 - переменная окружения `TG_API_TOKEN` - токен для уведомлений в телеграм, опционально
 - переменная окружения `TG_CHAT_ID` - идентификатор чата для уведомлений в телеграм, опционально
 - переменная окружения `ROOT_FREE_DISK_SPACE_THRESHOLD` - опциональный параметр алертов
 - переменная окружения `HOME_FREE_DISK_SPACE_THRESHOLD` - опциональный параметр алертов
### Требуемый результат
 - скрипт генерит конфигурационный файл прометеуса для сбора данных
 - скрипт генерит конфигурационный файл графаны, который отображает метрики, описанные ниже
 - скрипт генерит конфигурационный файл графаны, который настраивает алерты, описанные ниже
### Метрики
Здесь помимо банальных метрик (свободное место на дисках, RAM, использование CPU, дискового IO и сети, uptime)
буду рад вашим предложениям на тему того, за чем стоит следить. В свободном доступе есть немало готовых
дашбордов, можно взять что-то готовое и подтюнить.
### Алерты (если заданы TG_API_TOKEN и TG_CHAT_ID)
 - если `ROOT_FREE_DISK_SPACE_THRESHOLD` задана: если на диске, монитрованном на `/`, осталось менее `ROOT_FREE_DISK_SPACE_THRESHOLD` ГБ - нужно слать уникальный алерт в телеграм
 - если `HOME_FREE_DISK_SPACE_THRESHOLD` задача: если на диске, монитрованном на `/home`, осталось менее `HOME_FREE_DISK_SPACE_THRESHOLD` ГБ - нужно слать уникальный алерт в телеграм
 - если нет данных от экспортеров или прометеуса - нужно слать уникальный алерт в телеграм
Помимо этих алертов буду рад вашим предложениям.
### Нефункциональные требования
 - данные должны сохраняться после перезапуска докер контейнера с графаной и прометеусом
 - данные должны сохраняться после пересоздания докер контейнера с графаной и прометеусом
 - должна быть возможность удалить все данные и пересоздать контейнер с нуля
 - поскольку серверов несколько, нужна удобная возможность переключаться между ними, желательно без
 перезагрузки дашборда
 - данные графаны и прометеуса должны ротироваться, они не должны занимать больше 20/30/40 ГБ - буду
 рад вашим рекомендациям

# Следующие шаги
Если вам интересно, киньте в телеграм сообщение со следующей информацией:
 - какой у вас есть релеватный опыт
 - какой хотите часовой рейт
 - как предлагаете передавать адреса экспортеров

Дальше, если нам обоим интересно, мы обсуждаем дополнительные метрики и алерты, уточняем оценку работы, я даю адрес реального экспортена и начинаем.

# Задача 2
Для защиты от случая, когда сервер с графаной ложится, планируется иметь два сервера с графаной. Второй сервер
предполагается поднимать тем же скриптом. Надо будет доработать скрипт:
### Входные данные
 - адреса серверов с графаной (https), их может быть несколько. По формату - как с адресами экспортеров
### Алерты
 - если адрес сервера с графаной не отвечает на healthcheck'и - нужно слать уникальный алерт в телеграм